<!DOCTYPE html>
<html>
<head>
    <title>工具4：Markdown → 微信公众号完美排版</title>
    <style>
        body { font-family: Arial; margin: 20px; background: #f4f4f4; }
        .container { display: flex; gap: 20px; max-width: 1400px; margin: 0 auto; }
        textarea { width: 100%; height: 80vh; font-family: Consolas; font-size: 16px; }
        .preview { width: 100%; height: 80vh; border: 1px solid #ddd; background: white; }
        button { padding: 12px 24px; font-size: 18px; margin: 10px 0; }
        .tips { color: #666; font-size: 14px; }
    </style>
</head>
<body>
<h1>工具4：Markdown → 微信公众号完美排版（免费无限制）</h1>
<div class="container">
    <div>
        <textarea id="md" placeholder="在此粘贴 Markdown 内容，支持表格、代码块、公式、图片链接...">{{ "```python\nprint('Hello 微信公众号')\n```" }}</textarea>
        <button onclick="convert()">一键转换 → 复制到公众号</button>
        <p class="tips">支持：表格、代码高亮、图片、公式、标题、引用、列表</p>
    </div>
    <iframe id="preview" class="preview"></iframe>
</div>

<script>
async function convert() {
    const md = document.getElementById('md').value;
    const res = await fetch('/api/md2wechat', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: new URLSearchParams({'md_text': md})
    });
    const data = await res.json();
    if(data.success) {
        const doc = document.getElementById('preview').contentWindow.document;
        doc.open(); doc.write(data.html); doc.close();
        alert('转换完成！在新窗口右键 → 复制全部 → 粘贴到微信公众号编辑器即可完美排版');
    } else {
        alert('转换失败：' + data.error);
    }
}
// 默认示例
convert();
</script>
</body>
</html>
