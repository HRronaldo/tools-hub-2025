{% extends "base.html" %}

{% block title %}工具4：Markdown → 微信公众号完美排版{% endblock %}

{% block header %}Markdown → 微信公众号完美排版（免费 · 无限制 · 比 mdnice 更好用）{% endblock %}

{% block content %}
<style>
    .inner-container { display: flex; gap: 25px; }
    @media (max-width: 1200px) { .inner-container { flex-direction: column; } }
    .editor, .preview-box { width: 50%; display: flex; flex-direction: column; }
    @media (max-width: 1200px) { .editor, .preview-box { width: 100%; } }
    textarea { width: 100%; height: 80vh; font-family: Consolas, monospace; font-size: 16px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; background: #fff; resize: none; box-sizing: border-box; }
    iframe { width: 100%; height: 80vh; border: 1px solid #ddd; border-radius: 8px; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    button { margin: 15px 0; padding: 16px 40px; background: #0066ff; color: white; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; align-self: flex-start; transition: background 0.2s; }
    button:hover { background: #0055cc; }
    button:disabled { background: #999; cursor: not-allowed; }
    .tips { background: #f0f8ff; padding: 20px; border-radius: 12px; border-left: 5px solid #0066ff; font-size: 15px; line-height: 1.8; margin-top: 30px; }
    .highlight { color: #d00; font-weight: bold; }
</style>

<div class="inner-container">
    <div class="editor">
        <textarea id="md" placeholder="在此粘贴你的 Markdown 内容，支持表格、代码高亮、LaTeX 公式、脚注等..."># Markdown + 公式 + 脚注终极测试

## 一、行内代码示例
我们可以在文中使用行内代码，比如 `const x = 10;` 或 `print("Hello")` 来展示代码片段。

## 二、行内公式
质能方程：$E=mc^2$，速度之和：$v_1 + v_2$。

## 三、块级公式（居中大字）
$$
E = mc^2
$$

$$
\int_0^\infty e^{-x^2} dx = \frac{\sqrt{\pi}}{2}
$$

## 四、代码块示例（Python）
```python
def passive_income():
    build_tools()
    deploy_to_nas()
    open_adsense()
    sleep_forever()
    print("躺赚成功！")
```

## 五、代码块示例（JavaScript）
```javascript
async function convert() {
    const md = document.getElementById('md').value || '';
    const res = await fetch('/api/md2wechat', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: new URLSearchParams({'md_text': md})
    });
    const data = await res.json();
    console.log(data);
}
```

## 六、表格测试

| 平台 | 日活 | 适合内容 |
|------|------|---------|
| 微信公众号 | 12亿 | 长文/干货 |
| 小红书 | 2.6亿 | 图文/种草 |
| 知乎 | 1亿 | 问答/深度 |

## 七、脚注测试
这是正文内容，需要解释某个概念[^1]。
另一种引用方式[^2]，放在句子中间。

[^1]: 这是第一个脚注的内容，会在文章末尾显示。
[^2]: 这是第二个脚注，可以包含更多信息。

这是正文内容，需要解释某个概念[^1]。
另一种引用方式[^2]，放在句子中间。

        </textarea>
        <button id="convert-btn" onclick="convert()">转换并预览</button>
    </div>
    <div class="preview-box">
        <iframe id="preview"></iframe>
    </div>
</div>

<script>
async function convert() {
    const btn = document.getElementById('convert-btn');
    btn.disabled = true;
    btn.textContent = '转换中...';

    const md = document.getElementById('md').value || '';
    const res = await fetch('/api/md2wechat', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: new URLSearchParams({'md_text': md})
    });
    const data = await res.json();

    if (data.success) {
        const doc = document.getElementById('preview').contentWindow.document;
        doc.open();
        doc.write(data.html);
        doc.close();

        alert(`转换成功！

请按以下操作复制：

1. 在右侧预览区域右键
2. 选择 【查看页面源代码】
3. 全选（Ctrl+A） → 复制（Ctrl+C）
4. 粘贴到微信公众号编辑器即可完美还原！`);
    } else {
        alert("转换失败：" + data.error);
    }

    btn.disabled = false;
    btn.textContent = '转换并预览';
}
window.onload = convert;
</script>
{% endblock %}
