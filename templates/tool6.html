<!DOCTYPE html>
<html>
<head><title>微博/小红书无水印下载</title></head>
<body>
<h2>工具6：微博/小红书无水印视频下载</h2>
<form id="form">
    <input type="text" id="url" placeholder="粘贴视频链接" style="width:500px"><br><br>
    <button type="submit">开始下载</button>
</form>
<div id="result"></div>

<script>
document.getElementById('form').onsubmit = async (e) => {
    e.preventDefault();
    let url = document.getElementById('url').value;
    let res = await fetch('/api/download', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: new URLSearchParams({'url': url})
    });
    let data = await res.json();
    let resultDiv = document.getElementById('result');
    if(data.success) {
        resultDiv.innerHTML = `<h3>${data.title}</h3>
        <video src="${data.file}" controls style="max-width:100%; height:auto;" preload="metadata" onerror="console.error('Video load failed:', this.src); this.nextElementSibling.style.display='block';">
            您的浏览器不支持视频播放。请直接下载。
        </video>
        <p style="color:red; display:none;">视频加载失败（网络/格式问题），请点击下载。</p>
        <a href="${data.file}" download="${data.title}.mp4" style="display:block; margin-top:10px;">点击下载 MP4</a>`;
        console.log('Video src:', data.file);  // 调试：浏览器 F12 检查路径
    } else {
        resultDiv.innerHTML = `<p style="color:red;">失败：${data.error}</p>`;
    }
};
</script>
</body>
</html>
